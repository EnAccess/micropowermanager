<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Laravel Erd</title>
    <style>
      body {
        margin: 0;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <erd-editor
      automatic-layout
      system-dark-mode
      enable-theme-builder
    ></erd-editor>
    <script>
      const checkModuleSupport = () =>
        "supports" in HTMLScriptElement
          ? HTMLScriptElement.supports("module")
          : "noModule" in document.createElement("script")

      const createScript = (src) => {
        return checkModuleSupport()
          ? import(src)
          : new Promise((resolve, reject) => {
              const script = document.createElement("script")
              script.onload = () => resolve()
              script.onerror = () => reject()
              script.src = src
              document.body.appendChild(script)
            })
      }

      const loader = (src, fallback) => {
        return createScript(src).catch(() => createScript(fallback))
      }

      const sql = atob(
        "Q1JFQVRFIFRBQkxFIGNvbXBhbmllcyAoCiAgICBpZCBiaWdpbnQgTk9UIE5VTEwgQVVUT19JTkNSRU1FTlQsCiAgICBuYW1lIHZhcmNoYXIoMjU1KSBOT1QgTlVMTCwKICAgIGFkZHJlc3MgdmFyY2hhcigyNTUpIE5PVCBOVUxMLAogICAgcGhvbmUgdmFyY2hhcigyNTUpIE5PVCBOVUxMLAogICAgY291bnRyeV9pZCBpbnRlZ2VyKDExKSBOT1QgTlVMTCBERUZBVUxUIC0xLAogICAgY3JlYXRlZF9hdCBkYXRldGltZSwKICAgIHVwZGF0ZWRfYXQgZGF0ZXRpbWUsCiAgICBlbWFpbCB2YXJjaGFyKDI1NSkgTk9UIE5VTEwsCiAgICBwcm90ZWN0ZWRfcGFnZV9wYXNzd29yZCB2YXJjaGFyKDI1NSksCiAgICBQUklNQVJZIEtFWShpZCkKKQpDUkVBVEUgVEFCTEUgY29tcGFueV9kYXRhYmFzZXMgKAogICAgaWQgYmlnaW50IE5PVCBOVUxMIEFVVE9fSU5DUkVNRU5ULAogICAgY29tcGFueV9pZCBiaWdpbnQgTk9UIE5VTEwsCiAgICBkYXRhYmFzZV9uYW1lIHZhcmNoYXIoMjU1KSBOT1QgTlVMTCwKICAgIGNyZWF0ZWRfYXQgZGF0ZXRpbWUsCiAgICB1cGRhdGVkX2F0IGRhdGV0aW1lLAogICAgUFJJTUFSWSBLRVkoaWQpCikKQ1JFQVRFIFRBQkxFIGNvbXBhbnlfam9icyAoCiAgICBpZCBiaWdpbnQgTk9UIE5VTEwgQVVUT19JTkNSRU1FTlQsCiAgICBjb21wYW55X2lkIGJpZ2ludCwKICAgIGpvYl9uYW1lIHZhcmNoYXIoMjU1KSBOT1QgTlVMTCwKICAgIGpvYl91dWlkIHZhcmNoYXIoMjU1KSwKICAgIHN0YXR1cyBpbnRlZ2VyKDExKSBOT1QgTlVMTCwKICAgIGNyZWF0ZWRfYXQgZGF0ZXRpbWUsCiAgICB1cGRhdGVkX2F0IGRhdGV0aW1lLAogICAgbWVzc2FnZSB2YXJjaGFyKDI1NSksCiAgICB0cmFjZSB2YXJjaGFyKDI1NSksCiAgICBQUklNQVJZIEtFWShpZCkKKQpDUkVBVEUgVEFCTEUgZGF0YWJhc2VfcHJveGllcyAoCiAgICBpZCBiaWdpbnQgTk9UIE5VTEwgQVVUT19JTkNSRU1FTlQsCiAgICBlbWFpbCB2YXJjaGFyKDI1NSkgTk9UIE5VTEwsCiAgICBma19jb21wYW55X2lkIGludGVnZXIoMTEpIE5PVCBOVUxMLAogICAgZmtfY29tcGFueV9kYXRhYmFzZV9pZCBpbnRlZ2VyKDExKSBOT1QgTlVMTCwKICAgIGNyZWF0ZWRfYXQgZGF0ZXRpbWUsCiAgICB1cGRhdGVkX2F0IGRhdGV0aW1lLAogICAgUFJJTUFSWSBLRVkoaWQpCikKQ1JFQVRFIFRBQkxFIG1wbV9wbHVnaW5zICgKICAgIGlkIGJpZ2ludCBOT1QgTlVMTCBBVVRPX0lOQ1JFTUVOVCwKICAgIHVzYWdlX3R5cGUgdmFyY2hhcigyNTUpIE5PVCBOVUxMIERFRkFVTFQgZ2VuZXJhbCwKICAgIG5hbWUgdmFyY2hhcigyNTUpIE5PVCBOVUxMLAogICAgZGVzY3JpcHRpb24gdGV4dCBOT1QgTlVMTCwKICAgIGNyZWF0ZWRfYXQgZGF0ZXRpbWUsCiAgICB1cGRhdGVkX2F0IGRhdGV0aW1lLAogICAgdGFpbF90YWcgdmFyY2hhcigyNTUpLAogICAgaW5zdGFsbGF0aW9uX2NvbW1hbmQgdmFyY2hhcigyNTUpLAogICAgcm9vdF9jbGFzcyB2YXJjaGFyKDI1NSksCiAgICBQUklNQVJZIEtFWShpZCkKKQpDUkVBVEUgVEFCTEUgcHJvdGVjdGVkX3BhZ2VzICgKICAgIGlkIGJpZ2ludCBOT1QgTlVMTCBBVVRPX0lOQ1JFTUVOVCwKICAgIG5hbWUgdmFyY2hhcigyNTUpIE5PVCBOVUxMLAogICAgY3JlYXRlZF9hdCBkYXRldGltZSwKICAgIHVwZGF0ZWRfYXQgZGF0ZXRpbWUsCiAgICBQUklNQVJZIEtFWShpZCkKKQpDUkVBVEUgVEFCTEUgdXNhZ2VfdHlwZXMgKAogICAgaWQgYmlnaW50IE5PVCBOVUxMIEFVVE9fSU5DUkVNRU5ULAogICAgbmFtZSB2YXJjaGFyKDI1NSkgTk9UIE5VTEwsCiAgICB2YWx1ZSB2YXJjaGFyKDI1NSkgTk9UIE5VTEwsCiAgICBjcmVhdGVkX2F0IGRhdGV0aW1lLAogICAgdXBkYXRlZF9hdCBkYXRldGltZSwKICAgIFBSSU1BUlkgS0VZKGlkKQopCkFMVEVSIFRBQkxFIGNvbXBhbmllcyBBREQgRk9SRUlHTiBLRVkgKGlkKSBSRUZFUkVOQ0VTIGNvbXBhbnlfZGF0YWJhc2VzIChjb21wYW55X2lkKQpBTFRFUiBUQUJMRSBjb21wYW5pZXMgQUREIEZPUkVJR04gS0VZIChpZCkgUkVGRVJFTkNFUyBjb21wYW55X2pvYnMgKGNvbXBhbnlfaWQpCkFMVEVSIFRBQkxFIGNvbXBhbmllcyBBREQgRk9SRUlHTiBLRVkgKGlkKSBSRUZFUkVOQ0VTIGRhdGFiYXNlX3Byb3hpZXMgKGNvbXBhbnlfaWQpCkFMVEVSIFRBQkxFIGNvbXBhbnlfZGF0YWJhc2VzIEFERCBGT1JFSUdOIEtFWSAoaWQpIFJFRkVSRU5DRVMgZGF0YWJhc2VfcHJveGllcyAoY29tcGFueV9kYXRhYmFzZV9pZCk=",
      )
      const editor = document.querySelector("erd-editor")

      if (checkModuleSupport()) {
        const scripts = [
          [
            "http://localhost:8000/vendor/laravel-erd/erd-editor.esm.js",
            "https://cdn.jsdelivr.net/npm/@dineug/erd-editor/+esm",
          ],
          [
            "http://localhost:8000/vendor/laravel-erd/erd-editor-shiki-worker.esm.js",
            "https://cdn.jsdelivr.net/npm/@dineug/erd-editor-shiki-worker/+esm",
          ],
        ].map(([src, fallback]) => loader(src, fallback))

        Promise.all(scripts)
          .then(([{ setGetShikiServiceCallback }, { getShikiService }]) =>
            setGetShikiServiceCallback(getShikiService),
          )
          .then(() => editor.setSchemaSQL(sql))
      } else {
        const scripts = [
          [
            "http://localhost:8000/vendor/laravel-erd/vuerd.min.js",
            "https://cdn.jsdelivr.net/npm/vuerd/dist/vuerd.min.js",
          ],
        ].map(([src, fallback]) => loader(src, fallback))

        Promise.all(scripts).then(() => editor.loadSQLDDL(sql))
      }
    </script>
  </body>
</html>
